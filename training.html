

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Training Procedure &mdash; UWNET  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Physical constraints" href="constraints.html" />
    <link rel="prev" title="Post Processing NGAqua" href="post-processing.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> UWNET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Scientific Description</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="post-processing.html">Post Processing NGAqua</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Training Procedure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mini-batches">Mini-batches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loss-function">Loss Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stabilizing-a-neural-network">Stabilizing a neural network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="constraints.html">Physical constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="sam.html">The System for Atmospheric Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="training-data-header.html">Training Data Header</a></li>
<li class="toctree-l1"><a class="reference internal" href="smoother.html">Biharmonic Smoother</a></li>
</ul>
<p class="caption"><span class="caption-text">Software Implementation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UWNET</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Training Procedure</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/training.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="training-procedure">
<span id="training-procedure"></span><h1>Training Procedure<a class="headerlink" href="#training-procedure" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mini-batches">
<span id="mini-batches"></span><h2>Mini-batches<a class="headerlink" href="#mini-batches" title="Permalink to this headline">¶</a></h2>
<p>A mini-batch is a collection of time series drawn from random <span class="math notranslate">\( (x,y) \)</span>
locations.</p>
</div>
<div class="section" id="loss-function">
<span id="loss-function"></span><h2>Loss Function<a class="headerlink" href="#loss-function" title="Permalink to this headline">¶</a></h2>
<p>We use a mass-weighted loss function for 3D variables and a non-mass-weighted one for two dimensional one.</p>
<p>Comparing variables that are two-dimensional with one-dimensional ones requires a little attention. One way to equally weight two dimensional variables in the loss function is to put all variables into energy or power units.</p>
</div>
<div class="section" id="stabilizing-a-neural-network">
<span id="stabilizing-a-neural-network"></span><h2>Stabilizing a neural network<a class="headerlink" href="#stabilizing-a-neural-network" title="Permalink to this headline">¶</a></h2>
<p>There is no guarrantee that a neural network which can predict <span class="math notranslate">\( Q_1 \)</span> and
<span class="math notranslate">\( Q_2 \)</span> will be stable when evaluated over many time steps. In fact it is
almost always not stable, and this lack of stability manifests as an exponential
growth in the underyling fields. This is likely due to the jacobian of the
learned neural network having eigenvalues that lie outside the stability region
of the explicit Euler time stepper we are using to train.</p>
<p>In previous work, we found that training the neural network to produce good
predictions over a sufficient interval in time stabilized the network.
Unfortunately, this approach also produced biased estimate of the apparent
sources. This bias occurs because there is a substantial statisticla difference
between the observed and predicted trajectories starting at a given time point.
This in turn, is likely caused by assuming that the integral of known forcing
<span class="math notranslate">\( g \)</span> in time can be approximate by its starting value <span class="math notranslate">\( g(t^n) \)</span>. While
this estimate itself might not be biased, when integrated into a non-linear time
stepper it can be.</p>
<p>A simpler strategy, which also achieves numerical stability of the known time
stepper is to directly penalize the unrealistic growth of the system under a
constant forcing. This removes the issues with bias. Therefore the penalized loss is <span class="math notranslate">\( J(f) = J_1(f) + \lambda J_2(f) \)</span>. The first loss is the error using the trapezoid rule to evaluate the change in the state:
\begin{align}
J_1(f) &amp;= E_n \left| x^{n+1} - \left[ x^{n} + h \frac{g^n + g^{n+1} + f(x^n) + f(x^{n+1})}{2}\right]\right|^2 .
\end{align}
To define the second loss, we introduce an operator which performs an Euler Step with the time-mean forcing for a given location <span class="math notranslate">\(i\)</span>:
\begin{align}
\psi_{i,h} x = x + h \left[ \bar{g}_i + f(x) \right].
\end{align}
Here, <span class="math notranslate">\(\bar{g}_i\)</span> is the time mean of the forcing for a location <span class="math notranslate">\(i\)</span>. Then, the mean-decay penalty term is defined as</p>
<p>\begin{align}
J_2(f; m, h) = E_{i,n} \left| \bar{x_i} - \psi_{i,h}^m x_i^n \right|^2
\end{align}</p>
<p>This expression demands that the learned dynamics approach the equilibrium state
under the time-mean forcings, regardless of the initial conditions. Unlike the
multiple time step loss, this simple equilibrium consistency constraint only
requires that the time-mean of the forcings is estimated well, rather than
demanding that time stepper works well.</p>
<p>In practice, <span class="math notranslate">\( J_1(f) \)</span> is computed for every time and spatial location in a batch, but we only compute <span class="math notranslate">\( J_2(f) \)</span> for a single randomly chosen starting time point <span class="math notranslate">\( n \)</span>. In practice, this is enough to penalize the unstable modes of the neural network time stepper.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="constraints.html" class="btn btn-neutral float-right" title="Physical constraints" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="post-processing.html" class="btn btn-neutral" title="Post Processing NGAqua" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Noah D. Brenowitz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>